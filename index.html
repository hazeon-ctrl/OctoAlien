<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neon Asteroids</title>
<style>
  body {
    margin: 0;
    background: black;
    overflow: hidden;
    font-family: monospace;
    color: #0ff;
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: radial-gradient(circle, #000 70%, #111);
  }
  /* Mobile Controls */
  .mobile-controls {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 15px;
    z-index: 1000;
  }
  .mobile-controls button {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    border: none;
    background: rgba(0,255,255,0.2);
    color: #0ff;
    font-size: 24px;
    font-family: inherit;
    box-shadow: 0 0 10px rgba(0,255,255,0.6);
    user-select: none;
  }
  .mobile-controls button:active {
    background: rgba(0,255,255,0.6);
  }
  @media (hover: hover) and (pointer: fine) {
    .mobile-controls { display: none; } /* Hide on desktop */
  }
</style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>

<!-- Mobile Controls -->
<div class="mobile-controls">
  <button id="btnLeft">âŸµ</button>
  <button id="btnRight">âŸ¶</button>
  <button id="btnFire">ðŸ”¥</button>
  <button id="btnBomb">ðŸ’£</button>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// === Game State ===
let player = { x: 400, y: 550, speed: 5 };
let bullets = [];
let explosives = [];
let keys = {};
let score = 0;

let spacePressed = false;
let isCharging = false;
let chargeStartTime = 0;
let lastShot = 0;
let fireRate = 200; // ms between shots

// === Input Handlers (Keyboard) ===
document.addEventListener("keydown", e => keys[e.code] = true);
document.addEventListener("keyup", e => keys[e.code] = false);

// === Shooting Logic ===
function shootBullet() {
  bullets.push({ x: player.x, y: player.y, speed: -8 });
}

function fireExplosive(chargeTime) {
  explosives.push({ x: player.x, y: player.y, radius: Math.min(chargeTime/10, 80) });
}

function detonateExplosive() {
  if (explosives.length > 0) {
    explosives.pop(); // remove one explosive
    score += 50; // test scoring
  }
}

// === Mobile Controls Simulation ===
function simulateKey(code, isDown) {
  keys[code] = isDown;
  if (code === "Space") {
    if (isDown && !spacePressed) {
      spacePressed = true;
      if (explosives.length > 0) {
        detonateExplosive();
      } else {
        chargeStartTime = Date.now();
        isCharging = true;
      }
    } else if (!isDown && spacePressed) {
      spacePressed = false;
      if (isCharging) {
        isCharging = false;
        const chargeTime = Date.now() - chargeStartTime;
        if (chargeTime > 200) fireExplosive(chargeTime);
        else shootBullet();
      }
    }
  }
}

const activeTouches = new Map();
function bindTouchButton(btnId, keyCode) {
  const btn = document.getElementById(btnId);
  btn.addEventListener("touchstart", e => {
    e.preventDefault();
    for (const touch of e.changedTouches) {
      activeTouches.set(touch.identifier, keyCode);
      simulateKey(keyCode, true);
    }
  });
  btn.addEventListener("touchend", e => {
    e.preventDefault();
    for (const touch of e.changedTouches) {
      const key = activeTouches.get(touch.identifier);
      if (key) {
        simulateKey(key, false);
        activeTouches.delete(touch.identifier);
      }
    }
  });
  btn.addEventListener("touchcancel", e => {
    e.preventDefault();
    for (const touch of e.changedTouches) {
      const key = activeTouches.get(touch.identifier);
      if (key) {
        simulateKey(key, false);
        activeTouches.delete(touch.identifier);
      }
    }
  });
}

// Bind mobile buttons
bindTouchButton("btnLeft", "KeyA");
bindTouchButton("btnRight", "KeyD");
bindTouchButton("btnFire", "ArrowUp");
bindTouchButton("btnBomb", "Space");

// === Game Loop ===
function update() {
  // Movement
  if (keys["KeyA"]) player.x -= player.speed;
  if (keys["KeyD"]) player.x += player.speed;

  // Auto-fire if Fire held
  if (keys["ArrowUp"] && Date.now() - lastShot > fireRate) {
    shootBullet();
    lastShot = Date.now();
  }

  // Update bullets
  bullets.forEach(b => b.y += b.speed);
  bullets = bullets.filter(b => b.y > 0);

  // Update explosives (falling just for demo)
  explosives.forEach(e => e.y -= 2);
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Draw player
  ctx.fillStyle = "#0ff";
  ctx.beginPath();
  ctx.arc(player.x, player.y, 15, 0, Math.PI*2);
  ctx.fill();

  // Draw bullets
  ctx.fillStyle = "#ff0";
  bullets.forEach(b => {
    ctx.fillRect(b.x-2, b.y-10, 4, 10);
  });

  // Draw explosives
  ctx.strokeStyle = "#f0f";
  explosives.forEach(e => {
    ctx.beginPath();
    ctx.arc(e.x, e.y, e.radius, 0, Math.PI*2);
    ctx.stroke();
  });

  // HUD
  ctx.fillStyle = "#0ff";
  ctx.fillText("Score: " + score, 10, 20);
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
